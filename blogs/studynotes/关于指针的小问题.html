<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>关于指针的小问题</title>
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/nav.css">
    <link rel="stylesheet" href="/css/blogs.css">
</head>

<body>
    <script src="/js/prism.js"></script>
    <!-- wrapper -->
    <div class="wrapper">
        <!-- header -->
        <div class="nheader">
            <h2 class="ntitle">Midstreamblog</h2>
            <h1 class="ntitle">关于指针的小问题</h1>
            <h3 class="ntitle">2021/05/20</h3>
        </div>
        <div class="divider"></div>
    </div>
    <div class="divider"></div>
    <div class="wrapper">
        <div class="divider"></div>
        <article>
            <pre>
            <code class="language-C">
/*
之前老师让我自学c++，因为懒没有学，拿来就直接用了，
导致在后续的应用中遇见了很多问题，比如今天。
今天在实现链表的前插方法时遇到了一个小问题，有关指针。
*/

#include &lt;iostream>
#include &lt;cstdlib>
using namespace std;

//最初嫌麻烦没打算用OOP来构造类，而是打算直接写一个简单的链表
//结构体
typedef int DataType;
typedef struct node{
    DataType data=0;
    node* next=NULL;
}LinkedList;


//前插函数和用于测试的main函数，报错
void pushfront(LinkedList* list, DataType data){
    list = new node{data,list};
}
int main(){
    LinkedList* plist;
    plist = new node{1,NULL};
    pushfront(plist,5);

    cout&lt;&lt;plist->data&lt;&lt;endl;//输出1
    cout&lt;&lt;plist->next&lt;&lt;endl;//输出空指针
    cout&lt;&lt;plist->next->data&lt;&lt;endl;//Segmentation fault
}


//不使用pushfront的main，不报错
int main(){
    LinkedList* plist;
    plist = new node{1,NULL};
    plist = new node{5,plist};

    cout&lt;&lt;plist->data&lt;&lt;endl;//输出1
    cout&lt;&lt;plist->next&lt;&lt;endl;//输出地址
    cout&lt;&lt;plist->next->data&lt;&lt;endl;//输出5
}


//对问题进行抽象与测试，得到如下
int d=5;
void test1(int *a3) {
	int* c = &d;
    a3 = c;
}
int main() {
	int b = 2;	int* a1 = &b;   int* a2 = &b;

	int* c = &d;
	a1 = c;
	cout &lt;&lt; *a1 &lt;&lt;endl;//输出5

	test1(a2);
	cout &lt;&lt; *a2 &lt;&lt;endl;//输出2
}
//分析出原因是在函数中没有对指针进行解引用，很弱智的错误
//我直到今天才意识到以前指针用的都不对（虽然我以前没怎么用过）
//将test(int* a3)中的a3 = c改成*a3 = *c即可


//尝试将pushfront改成如下
void pushfront(LinkedList* list, DataType data){
    *list = *new node{data,list};
}
//因为node中的next指针的内容*list被改动，导致链表成为回路


//再尝试将pushfront改成如下
void pushfront(LinkedList* list, DataType data){
    LinkedList tmp;
    LinkedList* p = &tmp;//避免野指针报错
    *p = *list;
    *list = *new node{data,p};
}//因为p和tmp的作用范围仅在函数中，导致main中访问的链表与函数中不同


//可以使用的版本如下，将tmp和p设成全局变量
LinkedList tmp;
LinkedList* p = &tmp;
void pushfront(LinkedList* list, DataType data){
    *p = *list;
    *list = *new node{data,p};
}//结构太乱，乐色


//结论：老老实实用类封装
            </code>
        </pre>

        </article>

    </div>
    <div class="divider"></div>
    <div class="divider"></div>
    <div class="divider"></div>
    <div class="divider"></div>
    <div class="divider"></div>
</body>
<div class="sidebar">
    <a href="/index.html"><img class="home" src="/img/logo/home.png" alt="home"></a>
    <a href="/nav/studynotes.html"><img class="back" src="/img/logo/back.png" alt="back"></a>
    <a href="#"><img class="back-top" src="/img/logo/top.png" alt="back to top"></a>
</div>
