<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>堆</title>
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/nav.css">
    <link rel="stylesheet" href="/css/blogs.css">
</head>

<body>
    <script src="/js/prism.js"></script>
    <!-- wrapper -->
    <div class="wrapper">
        <!-- header -->
        <div class="nheader">
            <h2 class="ntitle">Midstreamblog</h2>
            <h1 class="ntitle">堆</h1>
            <h3 class="ntitle">2021/06/06</h3>
        </div>
        <div class="divider"></div>
    </div>
    <div class="divider"></div>
    <div class="wrapper">
        <div class="divider"></div>
        <pre>
            <code class="language-C++">
//头文件
#pragma once
#include &lt;iostream>
#include &lt;algorithm>
using namespace std;

template &lt;class T>
class MaxHeap{
private:
    T* arr;
    int max_size;
    int size;

public:
    MaxHeap();
    MaxHeap(int max_size);
    ~MaxHeap();

    int search(T data);
    int insert(T data);
    int del(T data);
    void print();

private:
    void swap(T &a, T &b){
        T c = a;
        a = b;
        b = c;
    }

    void adjust_up(int start){
        int parent = (start-1)/2;
        if(arr[parent]>=arr[start]) return;
        swap(arr[parent],arr[start]);
        adjust_up(parent);
    }

    void adjust_down(int start){
        int left_child = start*2+1;
        int right_child = left_child+1;
        int max_child = left_child;

        if(left_child>size) return;
        if(right_child>size){
            if(arr[left_child]>arr[start])
                swap(arr[right_child],arr[left_child]);
            return;
        }
        if(arr[left_child]&lt;arr[right_child]) max_child++;
        swap(arr[start],arr[max_child]);
        adjust_down(max_child);
    }
};

            </code>
        </pre>
        <article>
            &ensp;
        </article>
        <pre>
            <code class="language-C++">
//cpp文件
//相比于之前，堆写的比较顺手
//这里写的是大堆
#include "MaxHeap.hpp"

template &lt;class T>
MaxHeap&lt;T>::MaxHeap(){
    new (this)MaxHeap(100);
    //这个写法网上看来的，不太懂
    //this = new MaxHeap(100) 会报错
}

template &lt;class T>
MaxHeap&lt;T>::MaxHeap(int max_size){
    this->arr = new T[max_size];
    this->max_size = max_size;
    this->size = 0;
}

//析构函数，以前从来没有写过
template &lt;class T>
MaxHeap&lt;T>::~MaxHeap(){
    size = 0;
    max_size = 0;
    delete[] arr;
}


//-1 means doesn't exist
template &lt;class T>
int MaxHeap&lt;T>::search(T data){
    for(int i=0;i&lt;this->size;i++)
        if(arr[i]==data) return i;
    return -1;
}

//-1 means failed to insert
template &lt;class T>
int MaxHeap&lt;T>::insert(T data){
    if(size==max_size){
        cout&lt;&lt;"MaxHeap full"&lt;&lt;endl;
        return -1;
    }
    if(this->search(data)!=-1){
        cout&lt;&lt;"data existed"&lt;&lt;endl;
        return -1;
    }
    arr[size] = data;
    this->adjust_up(size);
    this->size++;
    return 0;
}

//-1 means failed to delete
template &lt;class T>
int MaxHeap&lt;T>::del(T data){
    int pos = this->search(data);
    if(pos==-1){
        cout&lt;&lt;"data doesn't exist"&lt;&lt;endl;
        return -1;
    }
    this->swap(arr[pos],arr[size]);
    arr[size]=0;
    size--;
    this->adjust_down(pos);
    return 0;
}

template &lt;class T>
void MaxHeap&lt;T>::print(){
    for(int i=0;i&lt;size;i++){
        cout&lt;&lt;arr[i]&lt;&lt;"\t";
    }
}

//test
int main(){
     int a[] = {10, 40, 30, 60, 90, 70, 20, 50, 80};
    MaxHeap&lt;int>* p = new MaxHeap&lt;int>();
    for(int i=0;i&lt;9;i++){
        p->insert(a[i]);
    }
    p->print();
    cout&lt;&lt;endl;
    p->del(90);
    p->print();
}

//堆排序就只需要不断把堆顶的数据输出即可
            </code>
        </pre>

    </div>
    <div class="divider"></div>
    <div class="divider"></div>
    <div class="divider"></div>
    <div class="divider"></div>
    <div class="divider"></div>
</body>
<div class="sidebar">
    <a href="/index.html"><img class="home" src="/img/logo/home.png" alt="home"></a>
    <a href="/nav/studynotes.html"><img class="back" src="/img/logo/back.png" alt="back"></a>
    <a href="#"><img class="back-top" src="/img/logo/top.png" alt="back to top"></a>
</div>

</html>